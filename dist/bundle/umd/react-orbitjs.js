/*! For license information please see react-orbitjs.js.LICENSE.txt */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("react")):"function"==typeof define&&define.amd?define(["react"],t):"object"==typeof exports?exports.ReactOrbitjs=t(require("react")):e.ReactOrbitjs=t(e.react)}(this,(function(e){return function(){var t={679:function(e,t,r){"use strict";var o=r(296),s={childContextTypes:!0,contextType:!0,contextTypes:!0,defaultProps:!0,displayName:!0,getDefaultProps:!0,getDerivedStateFromError:!0,getDerivedStateFromProps:!0,mixins:!0,propTypes:!0,type:!0},n={name:!0,length:!0,prototype:!0,caller:!0,callee:!0,arguments:!0,arity:!0},i={$$typeof:!0,compare:!0,defaultProps:!0,displayName:!0,propTypes:!0,type:!0},a={};function c(e){return o.isMemo(e)?i:a[e.$$typeof]||s}a[o.ForwardRef]={$$typeof:!0,render:!0,defaultProps:!0,displayName:!0,propTypes:!0},a[o.Memo]=i;var p=Object.defineProperty,d=Object.getOwnPropertyNames,h=Object.getOwnPropertySymbols,u=Object.getOwnPropertyDescriptor,l=Object.getPrototypeOf,f=Object.prototype;e.exports=function e(t,r,o){if("string"!=typeof r){if(f){var s=l(r);s&&s!==f&&e(t,s,o)}var i=d(r);h&&(i=i.concat(h(r)));for(var a=c(t),y=c(r),m=0;m<i.length;++m){var b=i[m];if(!(n[b]||o&&o[b]||y&&y[b]||a&&a[b])){var P=u(r,b);try{p(t,b,P)}catch(e){}}}}return t}},103:function(e,t){"use strict";var r="function"==typeof Symbol&&Symbol.for,o=r?Symbol.for("react.element"):60103,s=r?Symbol.for("react.portal"):60106,n=r?Symbol.for("react.fragment"):60107,i=r?Symbol.for("react.strict_mode"):60108,a=r?Symbol.for("react.profiler"):60114,c=r?Symbol.for("react.provider"):60109,p=r?Symbol.for("react.context"):60110,d=r?Symbol.for("react.async_mode"):60111,h=r?Symbol.for("react.concurrent_mode"):60111,u=r?Symbol.for("react.forward_ref"):60112,l=r?Symbol.for("react.suspense"):60113,f=r?Symbol.for("react.suspense_list"):60120,y=r?Symbol.for("react.memo"):60115,m=r?Symbol.for("react.lazy"):60116,b=r?Symbol.for("react.block"):60121,P=r?Symbol.for("react.fundamental"):60117,g=r?Symbol.for("react.responder"):60118,S=r?Symbol.for("react.scope"):60119;function R(e){if("object"==typeof e&&null!==e){var t=e.$$typeof;switch(t){case o:switch(e=e.type){case d:case h:case n:case a:case i:case l:return e;default:switch(e=e&&e.$$typeof){case p:case u:case m:case y:case c:return e;default:return t}}case s:return t}}}function O(e){return R(e)===h}t.AsyncMode=d,t.ConcurrentMode=h,t.ContextConsumer=p,t.ContextProvider=c,t.Element=o,t.ForwardRef=u,t.Fragment=n,t.Lazy=m,t.Memo=y,t.Portal=s,t.Profiler=a,t.StrictMode=i,t.Suspense=l,t.isAsyncMode=function(e){return O(e)||R(e)===d},t.isConcurrentMode=O,t.isContextConsumer=function(e){return R(e)===p},t.isContextProvider=function(e){return R(e)===c},t.isElement=function(e){return"object"==typeof e&&null!==e&&e.$$typeof===o},t.isForwardRef=function(e){return R(e)===u},t.isFragment=function(e){return R(e)===n},t.isLazy=function(e){return R(e)===m},t.isMemo=function(e){return R(e)===y},t.isPortal=function(e){return R(e)===s},t.isProfiler=function(e){return R(e)===a},t.isStrictMode=function(e){return R(e)===i},t.isSuspense=function(e){return R(e)===l},t.isValidElementType=function(e){return"string"==typeof e||"function"==typeof e||e===n||e===h||e===a||e===i||e===l||e===f||"object"==typeof e&&null!==e&&(e.$$typeof===m||e.$$typeof===y||e.$$typeof===c||e.$$typeof===p||e.$$typeof===u||e.$$typeof===P||e.$$typeof===g||e.$$typeof===S||e.$$typeof===b)},t.typeOf=R},296:function(e,t,r){"use strict";e.exports=r(103)},703:function(e,t,r){"use strict";var o=r(414);function s(){}function n(){}n.resetWarningCache=s,e.exports=function(){function e(e,t,r,s,n,i){if(i!==o){var a=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw a.name="Invariant Violation",a}}function t(){return e}e.isRequired=e;var r={array:e,bigint:e,bool:e,func:e,number:e,object:e,string:e,symbol:e,any:e,arrayOf:t,element:e,elementType:e,instanceOf:t,node:e,objectOf:t,oneOf:t,oneOfType:t,shape:t,exact:t,checkPropTypes:n,resetWarningCache:s};return r.PropTypes=r,r}},697:function(e,t,r){e.exports=r(703)()},414:function(e){"use strict";e.exports="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED"},156:function(t){"use strict";t.exports=e}},r={};function o(e){var s=r[e];if(void 0!==s)return s.exports;var n=r[e]={exports:{}};return t[e](n,n.exports,o),n.exports}o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,{a:t}),t},o.d=function(e,t){for(var r in t)o.o(t,r)&&!o.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var s={};return function(){"use strict";o.r(s),o.d(s,{DataProvider:function(){return a},withData:function(){return l}});var e=o(156),t=o(697),r=o.n(t),n=r().shape({query:r().func.isRequired,on:r().func.isRequired,cache:r().object.isRequired,schema:r().object.isRequired});class i extends e.Component{constructor(e,t){super(e,t),this.dataStore=e.dataStore}getChildContext(){return{dataStore:this.dataStore}}render(){return e.Children.only(this.props.children)}}i.propTypes={dataStore:n.isRequired,children:r().element.isRequired},i.childContextTypes={dataStore:n.isRequired};var a=i,c=o(679),p=o.n(c);function d(e,t){if(e===t)return!0;const r=Object.keys(e),o=Object.keys(t);if(r.length!==o.length)return!1;const s=Object.prototype.hasOwnProperty;for(let o=0;o<r.length;o++)if(!s.call(t,r[o])||e[r[o]]!==t[r[o]])return!1;return!0}const h={},u=(e,t)=>({...t,...e});function l(t,r){const o=Boolean(t),s=t||h,i=r||u;return function(t){const r=`WithData(${function(e){return e.displayName||e.name||"Component"}(t)})`;class a extends e.Component{shouldComponentUpdate(){return this.haveOwnPropsChanged||this.hasDataStoreChanged}constructor(e,t){if(super(e,t),this.dataStore=e.dataStore||t.dataStore,!this.dataStore)throw new Error(`Could not find "dataStore" in either the context or props of "${r}". Either wrap the root component in a <DataProvider>, or explicitly pass "dataStore" as a prop to "${r}".`);this.clearCache()}makeReducePropsToRecords=(e,t)=>(r,o)=>{let s;try{s=e.cache.query(t[o])}catch(e){console.warn(e.message),s=void 0}return{...r,[o]:s}};computeChangedRecordProps=(e,t,r)=>this.selectivelyComputeRecordProps(e,t,r);computeAllRecordProps=(e,t)=>this.selectivelyComputeRecordProps(!0,e,t);computeChangedQueryProps=(e,t)=>{const r=this.getRecordQueries(e,t);return this.expressionChangedProps.reduce(this.makeReducePropsToRecords(e,r),{})};selectivelyComputeRecordProps=(e,t,r)=>{let o;return(!0===e||e.length)&&(o=this.getRecordQueries(t,r)),!0===e&&(e=Object.keys(o)),e.reduce(this.makeReducePropsToRecords(t,o),{})};getConvenienceProps=e=>(this.convenienceProps||(this.convenienceProps={dataStore:e,queryStore:(...t)=>e.query(...t),updateStore:(...t)=>e.update(...t)}),this.convenienceProps);getRecordQueries=(e,t)=>!this.mapRecordsIsConfigured||this.doRecordPropsDependOnOwnProps&&this.haveOwnPropsChanged?this.configureMapRecords(e,t):this.mapRecordsGivenOwnProps(t);mapRecordsGivenOwnProps=e=>this.recordPropsIsFunction?s(e):s;configureMapRecords=(e,t)=>{this.recordPropsIsFunction="function"==typeof s,this.doRecordPropsDependOnOwnProps=this.recordPropsIsFunction&&s.length>0,this.mapRecordsIsConfigured=!0;const r=this.mapRecordsGivenOwnProps(t),o=Object.keys(r),n={};return this.subscribedModels={},o.forEach((e=>this.subscribedModels[e]=[])),o.forEach((t=>{const o=r[t](e.queryBuilder).toQueryExpression();switch(o.op){case"findRecord":this.subscribedModels[t].push(o.record.type);break;case"findRecords":this.subscribedModels[t].push(o.type);break;case"findRelatedRecord":case"findRelatedRecords":this.subscribedModels[t].push(o.record.type),this.subscribedModels[t].push(this.dataStore.schema.models[o.record.type].relationships[o.relationship].model||this.dataStore.schema.models[o.record.type].relationships[o.relationship].type)}n[t]=o})),o.forEach((e=>{this.subscribedModels[e]=this.subscribedModels[e].filter(((e,t,r)=>r.indexOf(e)===t))})),o.forEach((e=>{void 0!==this.lastExpressions[e]&&JSON.stringify(n[e])===JSON.stringify(this.lastExpressions[e])||this.expressionChangedProps.push(e)})),this.lastExpressions=n,r};updateRecordPropsIfNeeded=()=>{let e={};if(null===this.recordProps)e={...this.getConvenienceProps(this.dataStore),...this.computeAllRecordProps(this.dataStore,this.props)};else if(this.haveOwnPropsChanged&&this.doRecordPropsDependOnOwnProps){e={...this.recordProps,...this.computeChangedQueryProps(this.dataStore,this.props)};const t=Object.keys(this.subscribedModels),r=Object.keys(this.getConvenienceProps(this.dataStore));Object.keys(this.recordProps).filter((e=>!t.includes(e)&&!r.includes(e))).forEach((t=>delete e[t]))}else e={...this.recordProps,...this.computeChangedRecordProps(this.dataStoreChangedProps,this.dataStore,this.props)};return!(this.recordProps&&d(e,this.recordProps)||(this.recordProps=e,0))};updateMergedPropsIfNeeded=()=>{const e=(t=this.recordProps,r=this.props,i(t,r));var t,r;return!(this.mergedProps&&d(e,this.mergedProps)||(this.mergedProps=e,0))};trySubscribe=()=>{o&&!this.isListening&&(this.isListening=!0,this.dataStore.on("transform",this.handleTransform))};tryUnsubscribe=()=>{this.isListening&&(this.isListening=null,this.dataStore.off("transform",this.handleTransform))};componentDidMount(){this.trySubscribe()}UNSAFE_componentWillReceiveProps(e){d(e,this.props)||(this.haveOwnPropsChanged=!0)}componentWillUnmount(){this.tryUnsubscribe(),this.clearCache()}clearCache=()=>{this.convenienceProps=null,this.recordProps=null,this.mergedProps=null,this.haveOwnPropsChanged=!0,this.dataStoreChangedProps=[],this.expressionChangedProps=[],this.hasDataStoreChanged=!0,this.renderedElement=null,this.mapRecordsIsConfigured=!1,this.lastExpressions={},this.subscribedModels={}};handleTransform=e=>{if(!this.isListening)return;const t=Array.isArray(e.operations)?e.operations:[e.operations],r=[];t.forEach((e=>{switch(e.op){case"addRecord":case"replaceRecord":case"updateRecord":if(r.push(e.record.type),void 0===e.record.relationships)break;Object.keys(e.record.relationships).forEach((t=>{r.push(this.dataStore.schema.models[e.record.type].relationships[t].model||this.dataStore.schema.models[e.record.type].relationships[t].type)}));break;case"removeRecord":r.push(e.record.type);const t=this.dataStore.schema.models[e.record.type].relationships;Object.keys(t).map((e=>t[e])).forEach((e=>{r.push(e.model||e.type)}));break;case"replaceKey":case"replaceAttribute":r.push(e.record.type);break;case"addToRelatedRecords":case"removeFromRelatedRecords":case"replaceRelatedRecord":r.push(e.record.type),r.push(this.dataStore.schema.models[e.record.type].relationships[e.relationship].model||this.dataStore.schema.models[e.record.type].relationships[e.relationship].type);break;case"replaceRelatedRecords":r.push(e.record.type),e.relatedRecords.forEach((e=>{r.push(e.type)}));break;default:console.warn("This transform operation is not supported in react-orbitjs.")}})),new Set(r).forEach((e=>{Object.keys(this.subscribedModels).forEach((t=>{this.subscribedModels[t].includes(e)&&(this.hasDataStoreChanged=!0,this.dataStoreChangedProps.push(t))}))})),this.forceUpdate()};render(){const{haveOwnPropsChanged:r,hasDataStoreChanged:o,renderedElement:s}=this;let n=!0;s&&(n=o||r&&this.doRecordPropsDependOnOwnProps);let i=!1;n&&(i=this.updateRecordPropsIfNeeded()),this.haveOwnPropsChanged=!1,this.hasDataStoreChanged=!1,this.dataStoreChangedProps=[],this.expressionChangedProps=[];let a=!0;return a=!(!i&&!r)&&this.updateMergedPropsIfNeeded(),!a&&s?s:(this.renderedElement=(0,e.createElement)(t,this.mergedProps),this.renderedElement)}}return a.displayName=r,a.WrappedComponent=t,a.contextTypes={dataStore:n},a.propTypes={dataStore:n},p()(a,t)}}}(),s}()}));